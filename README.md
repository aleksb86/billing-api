## billing-api
Small, cute and single functionality demo project "Billing API"

billing-api - демонстрационный проект, реализующий элементарный учет средств на счетах. Используемый стэк: Ruby on Rails (--api), Postgresql, Rspec.

### Архитектура и данные

Проект работает с тремя основными сущностями:
- account (счет пользователя) - абстрактный счет с номером (поле code в таблице accounts). Модель Account.
- operation - проводки по счетам (операции, изменяющие баланс счета account). Модель Operation.
- operation_name - наименования операций. Справочник наименований операций. Модель OperationName.

Для одного счета (account) может быть 0 или N операций (operation). Каждая операция содержит величину изменения баланса - amount. Amount может быть как положительным, так и отрицательным. Баланс счета на конкретный момент времени определяется величиной остатка (поле reminder в таблице operations). Остаток рассчитывается каждый раз при создании операции (см. модель Operation). Подразумевается, что остаток на счете межет быть отрицательным.

Отчет по операциям со счетом строится следующим образом:

`GET /api/v1/accounts/1/operations_by_range/?start_date=2021-09-09T21:00:00&end_date=2021-09-09T22:50:00`

Параметры запроса:
1 - идентификатор счета, для которого строим отчет

start_date - время начала периода

end_date - время окончания периода

Результат отчета:
- JSON, содержащий пустой массив, если отправлены ошибочные параметры запроса или за указанный период нет операций.
- JSON, содержащий массив операций. Каждый элемент (операция) содержит атрибуты: id - идентификатор операции, amount - величина (сумма) операции, reminder - остаток на счете после совершения операции, operation_name - наименование операции (из справочника), time - время создания операции. В массиве операции упорядочены по времени создания. В первой (по порядку) операции reminder содержит состояние счета на начало периода, соответственно, в последней операции reminder будет содержать состояние счета на конец периода (т.е. состояние после последнего изменения).

### Установка и запуск

```shell
docker-compose build web
docker-compose up -d
docker-compose exec web bundle exec rails db:prepare db:seed
```

### Использование консоли

```shell
# Поскольку для базового образа используем Linux Alpine, то доступна оболочка ash
docker-compose exec web ash
```

### Стандартный запуск проекта

```shell
docker-compose up -d
```

### Запуск тестов

```shell
docker-compose exec web rspec
```