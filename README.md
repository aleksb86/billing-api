## billing-api
Small, cute and single functionality demo project "Billing API"

billing-api - демонстрационный проект, реализующий элементарный учет средств на счетах. Используемый стэк: Ruby on Rails (--api), Postgresql, Rspec.

### Архитектура и данные

Проект работает с тремя основными сущностями:
- account (счет пользователя) - абстрактный счет с номером (поле code в таблице accounts). Модель Account.
- operation - проводки по счетам (операции, изменяющие баланс счета account). Модель Operation.
- operation_name - наименования операций. Справочник наименований операций. Модель OperationName.

Для одного счета (account) может быть 0 или N операций (operation). Каждая операция содержит величину изменения баланса - amount. Amount может быть как положительным, так и отрицательным. Баланс счета на конкретный момент времени определяется при помощи суммирования amount всех операций счета за определенный период времени. Подразумевается, что остаток на счете может быть отрицательным.

Отчет по операциям со счетом строится следующим образом:

`GET /api/v1/accounts/1/operations_by_range/?start_time=2021-09-09T21:00:00&end_time=2021-09-09T22:50:00`

Параметры запроса:
1 - идентификатор счета, для которого строим отчет

start_time - время начала периода

end_time - время окончания периода

Результат отчета:


- Если отправлены ошибочные параметры запроса или за указанный период нет операций:

```
{
  "start_remainder": {                                      <- Начальный остаток
    "amount": 0,                                            <- Величина остатка
    "on_beginning_period": "2021-09-15T00:00:00.000+00:00"  <- Время начала периода
  },
  "end_remainder": {                                        <- Конечный остаток
    "amount": 0,                                            <- Величина остатка
    "on_end_of_period": "2021-09-15T01:00:00.000+00:00"     <- Время окончания периода
  },
  "operations": []                                          <- Пустой массив операций
}
```

- Результат успешного запроса:

```
{
  "start_remainder": {                                      <- Начальный остаток
    "amount": -10,                                          <- Величина остатка
    "on_beginning_period": "2021-09-14T00:00:00.000+00:00"  <- Время начала периода
  },
  "end_remainder": {                                        <- Конечный остаток
    "amount": -184,                                         <- Величина остатка
    "on_end_of_period": "2021-09-14T01:00:00.000+00:00"     <- Время окончания периода
  },
  "operations": [{
    "id": 6,
    "amount": -10,
    "account": "018712411754393",
    "operation_name": "ABN AMRO CORPORATE FINANCE LIMITED",
    "time": "2021-09-14T00:48:26.323Z"
  }, ... ]                                                  <- Массив операций по счету за период времени
}
```

Каждый элемент (операция) содержит атрибуты: id - идентификатор операции, amount - величина (сумма) операции, account - код счета (из справочника), operation_name - наименование операции (из справочника), time - время создания операции. В массиве операции упорядочены по времени создания.

### Установка и запуск

```shell
docker-compose build web
docker-compose up -d
docker-compose exec web bundle exec rails db:prepare db:seed
```

### Использование консоли

```shell
# Поскольку для базового образа используем Linux Alpine, то доступна оболочка ash
docker-compose exec web ash
```

### Стандартный запуск проекта

```shell
docker-compose up -d
```

### Запуск тестов

```shell
docker-compose exec web rspec
```